<!doctype html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <!-- SEO Optimizations -->
    <meta name="robots" content="index, follow">
    <meta name="googlebot" content="index, follow">
    <link rel="canonical" href="https://your-domain.com/">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#8b5cf6" />
    <meta name="theme-color" content="#8b5cf6" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#581c87" media="(prefers-color-scheme: dark)">
    <meta name="background-color" content="#0f172a" />
    <meta name="color-scheme" content="dark light" />
    <meta name="description" content="Manage and track your tasks with progress monitoring and analytics. TaskFlow helps you stay organized and productive." />
    
    <!-- Apple PWA Meta Tags -->
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="TaskFlow" />
    
    <!-- Performance Optimizations -->
    <link rel="modulepreload" href="/src/main.jsx">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="/icons/icon-192x192.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="/icons/icon-152x152.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/icon-192x192.png" />
    
    <!-- Microsoft Tiles for Windows -->
    <meta name="msapplication-TileColor" content="#8b5cf6" />
    <meta name="msapplication-TileImage" content="/icons/icon-144x144.png" />
    
    <!-- Web App Manifest -->
    <link rel="manifest" href="/manifest.json" />
    
    <!-- Standard Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    
    <!-- Open Graph Meta Tags for Social Sharing -->
    <meta property="og:title" content="TaskFlow - Task Management & Progress Tracking" />
    <meta property="og:description" content="Manage and track your tasks with progress monitoring and analytics. Stay organized and productive with TaskFlow." />
    <meta property="og:image" content="/icons/icon-512x512.png" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://your-domain.com" />
    <meta property="og:site_name" content="TaskFlow" />
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="TaskFlow - Task Management & Progress Tracking" />
    <meta name="twitter:description" content="Manage and track your tasks with progress monitoring and analytics." />
    <meta name="twitter:image" content="/icons/icon-512x512.png" />
    
    <!-- Security Headers -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff" />
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin" />
    
    <title>TaskFlow - Task Management & Progress Tracking</title>
    
    <!-- Structured Data for SEO -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "TaskFlow",
      "description": "Task Management & Progress Tracking Application",
      "url": "https://your-domain.com",
      "applicationCategory": "ProductivityApplication",
      "operatingSystem": "Any",
      "browserRequirements": "Requires JavaScript. Requires HTML5.",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "author": {
        "@type": "Organization",
        "name": "TaskFlow Team"
      },
      "featureList": [
        "Task Creation and Management",
        "Progress Tracking",
        "Offline Support",
        "Push Notifications",
        "Analytics Dashboard"
      ]
    }
    </script>
    
    <!-- Critical CSS for Performance -->
    <style>
      /* Critical CSS for initial load - optimized for performance */
      * {
        box-sizing: border-box;
      }
      
      body {
        margin: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
          'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        background: linear-gradient(135deg, #0f172a 0%, #581c87 50%, #0f172a 100%);
        min-height: 100vh;
        color: white;
        line-height: 1.6;
      }
      
      /* Skip links for accessibility */
      .skip-links {
        position: absolute;
        top: -40px;
        left: 6px;
        background: #8b5cf6;
        color: white;
        padding: 8px;
        text-decoration: none;
        border-radius: 4px;
        z-index: 10000;
        transition: top 0.3s;
      }
      
      .skip-links:focus {
        top: 6px;
      }
      
      /* Loading spinner optimized for performance */
      .initial-loader {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #0f172a 0%, #581c87 50%, #0f172a 100%);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        will-change: opacity;
      }
      
      .loader-content {
        text-align: center;
        transform: translateZ(0); /* Hardware acceleration */
      }
      
      .loader-spinner {
        width: 50px;
        height: 50px;
        border: 3px solid rgba(139, 92, 246, 0.3);
        border-top: 3px solid #8b5cf6;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        will-change: transform;
      }
      
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      
      .loader-text {
        color: white;
        margin-top: 20px;
        font-size: 18px;
        font-weight: 500;
        opacity: 0.9;
      }
      
      /* Focus visible styles for accessibility */
      .focus-visible:focus {
        outline: 2px solid #8b5cf6;
        outline-offset: 2px;
      }
      
      /* High contrast mode support */
      @media (prefers-contrast: high) {
        body {
          background: #000;
          color: #fff;
        }
        .loader-spinner {
          border-color: #fff;
          border-top-color: #8b5cf6;
        }
      }
      
      /* Reduced motion support */
      @media (prefers-reduced-motion: reduce) {
        .loader-spinner {
          animation: none;
        }
        * {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }
      }

      /* Environment indicator for development */
      .env-indicator {
        position: fixed;
        top: 10px;
        right: 10px;
        background: rgba(255, 193, 7, 0.9);
        color: #000;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: bold;
        z-index: 10001;
        display: none;
      }
      
      .env-development .env-indicator {
        display: block;
      }
      
      .env-staging .env-indicator {
        display: block;
        background: rgba(255, 87, 34, 0.9);
        color: white;
      }
    </style>
  </head>
  <body>
    <!-- NUCLEAR CONSOLE FIX - CRITICAL: ADD THIS FIRST BEFORE ANY OTHER SCRIPTS -->
    <script>
      (function() {
        'use strict';
        
        // Store the original console methods immediately
        const originalConsole = {
          log: console.log,
          error: console.error,
          warn: console.warn,
          info: console.info,
          debug: console.debug,
          trace: console.trace,
          group: console.group,
          groupEnd: console.groupEnd,
          table: console.table,
          time: console.time,
          timeEnd: console.timeEnd
        };

        // Safe argument processor
        function processSafeArgs(...args) {
          return args.map(arg => {
            try {
              if (arg === null) return 'null';
              if (arg === undefined) return 'undefined';
              if (typeof arg === 'string') return arg;
              if (typeof arg === 'number') return arg;
              if (typeof arg === 'boolean') return arg;
              if (typeof arg === 'function') return `[Function: ${arg.name || 'anonymous'}]`;
              if (arg instanceof Error) return `${arg.name}: ${arg.message}`;
              if (arg instanceof Date) return arg.toISOString();
              
              // For objects, safely stringify
              if (typeof arg === 'object') {
                try {
                  // Handle circular references and complex objects
                  const seen = new WeakSet();
                  const safeObj = JSON.stringify(arg, (key, value) => {
                    if (typeof value === 'object' && value !== null) {
                      if (seen.has(value)) return '[Circular]';
                      seen.add(value);
                      
                      // Limit object depth
                      if (key && typeof key === 'string' && key.length > 0) {
                        return '[Object]';
                      }
                    }
                    return value;
                  });
                  return safeObj;
                } catch (e) {
                  return '[Unserializable Object]';
                }
              }
              
              return String(arg);
            } catch (e) {
              return '[Safe Conversion Failed]';
            }
          });
        }

        // Create completely safe console methods
        const safeConsole = {
          log: function(...args) {
            try {
              const safeArgs = processSafeArgs(...args);
              originalConsole.log.apply(console, safeArgs);
            } catch (e) {
              originalConsole.log('[Console Log Error]');
            }
          },
          
          error: function(...args) {
            try {
              const safeArgs = processSafeArgs(...args);
              originalConsole.error.apply(console, safeArgs);
            } catch (e) {
              originalConsole.error('[Console Error]');
            }
          },
          
          warn: function(...args) {
            try {
              const safeArgs = processSafeArgs(...args);
              originalConsole.warn.apply(console, safeArgs);
            } catch (e) {
              originalConsole.warn('[Console Warning]');
            }
          },
          
          info: function(...args) {
            try {
              const safeArgs = processSafeArgs(...args);
              originalConsole.info.apply(console, safeArgs);
            } catch (e) {
              originalConsole.info('[Console Info]');
            }
          },
          
          debug: function(...args) {
            try {
              const safeArgs = processSafeArgs(...args);
              originalConsole.debug.apply(console, safeArgs);
            } catch (e) {
              originalConsole.debug('[Console Debug]');
            }
          },
          
          trace: function(...args) {
            try {
              const safeArgs = processSafeArgs(...args);
              originalConsole.trace.apply(console, safeArgs);
            } catch (e) {
              originalConsole.trace('[Console Trace]');
            }
          },
          
          group: originalConsole.group,
          groupEnd: originalConsole.groupEnd,
          table: function(data) {
            try {
              if (typeof data === 'object' && data !== null) {
                originalConsole.table('[Table Data - See Raw]');
                originalConsole.log(processSafeArgs(data)[0]);
              } else {
                originalConsole.table(data);
              }
            } catch (e) {
              originalConsole.log('[Console Table Error]');
            }
          },
          time: originalConsole.time,
          timeEnd: originalConsole.timeEnd
        };

        // Nuclear override - completely replace console methods
        function nuclearConsoleOverride() {
          try {
            Object.defineProperty(window, 'console', {
              value: safeConsole,
              writable: false,
              configurable: true
            });
            
            // Also override on global object
            if (typeof global !== 'undefined') {
              global.console = safeConsole;
            }
            
            // Override specific methods individually
            Object.keys(safeConsole).forEach(method => {
              try {
                Object.defineProperty(console, method, {
                  value: safeConsole[method],
                  writable: false,
                  configurable: true
                });
              } catch (e) {
                // Ignore individual method override errors
              }
            });
            
          } catch (e) {
            // Fallback - just replace the methods directly
            console.log = safeConsole.log;
            console.error = safeConsole.error;
            console.warn = safeConsole.warn;
            console.info = safeConsole.info;
            console.debug = safeConsole.debug;
            console.trace = safeConsole.trace;
            console.table = safeConsole.table;
          }
        }

        // Apply immediately
        nuclearConsoleOverride();
        
        // Apply on DOM ready
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', nuclearConsoleOverride);
        } else {
          nuclearConsoleOverride();
        }
        
        // Apply periodically to counter any overrides
        setInterval(function() {
          if (console.log.toString().includes('overrideMethod') || 
              console.error.toString().includes('overrideMethod')) {
            nuclearConsoleOverride();
          }
        }, 1000);
        
        // Apply on window load
        window.addEventListener('load', nuclearConsoleOverride);
        
        // Disable React DevTools console interception
        if (window.__REACT_DEVTOOLS_GLOBAL_HOOK__) {
          try {
            window.__REACT_DEVTOOLS_GLOBAL_HOOK__.onCommitFiberRoot = null;
            window.__REACT_DEVTOOLS_GLOBAL_HOOK__.onCommitFiberUnmount = null;
            window.__REACT_DEVTOOLS_GLOBAL_HOOK__.supportsFiber = false;
          } catch (e) {
            // Ignore errors
          }
        }
        
        // Prevent future React DevTools hooks
 
        
        console.log('🛡️ Nuclear console protection activated');
      })();
    </script>

    <!-- Skip Links for Accessibility -->
    <a href="#main-content" class="skip-links">Skip to main content</a>
    <a href="#navigation" class="skip-links">Skip to navigation</a>
    
    <!-- Environment indicator -->
    <div class="env-indicator" id="env-indicator">
      <!-- Will be populated by JavaScript -->
    </div>
    
    <noscript>
      <div style="
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        background: linear-gradient(135deg, #0f172a 0%, #581c87 50%, #0f172a 100%);
        color: white;
        font-family: system-ui, -apple-system, sans-serif;
        text-align: center;
        padding: 20px;
      ">
        <div role="alert">
          <h1>JavaScript Required</h1>
          <p>TaskFlow requires JavaScript to run. Please enable JavaScript in your browser settings and reload the page.</p>
          <p>For help enabling JavaScript, visit <a href="https://enable-javascript.com" style="color: #8b5cf6;">enable-javascript.com</a></p>
        </div>
      </div>
    </noscript>
    
    <!-- Initial Loading Screen -->
    <div id="initial-loader" class="initial-loader" role="status" aria-label="Loading TaskFlow application">
      <div class="loader-content">
        <div class="loader-spinner" aria-hidden="true"></div>
        <div class="loader-text">Loading TaskFlow...</div>
        <div style="font-size: 14px; opacity: 0.7; margin-top: 10px;">
          Preparing your productivity workspace
        </div>
      </div>
    </div>
    
    <!-- React App Root -->
    <div id="root"></div>
    <main id="main-content" style="display: none;">
      <!-- Content will be injected by React -->
    </main>
    
    <script type="module" src="/src/main.jsx"></script>
    
    <!-- COMPLETE PWA INSTALLATION SCRIPT -->
    <script>
      // Safe environment detection using import.meta.env through dynamic import
      let appConfig = {
        environment: 'development',
        isProduction: false,
        apiUrl: 'http://localhost:5000/api',
        version: '1.0.0',
        buildTime: new Date().toISOString()
      };

      // Try to get config from the React app when it loads
      const getConfigFromApp = () => {
        try {
          // These will be set by the main.jsx when it loads
          if (window.__APP_CONFIG__) {
            appConfig = { ...appConfig, ...window.__APP_CONFIG__ };
          }
        } catch (e) {
          console.warn('Could not load app config:', e.message);
        }
      };

      // Performance monitoring
      const perfStart = performance.now();
      
      // Remove initial loader when React app loads
      const removeLoader = () => {
        const loader = document.getElementById('initial-loader');
        const mainContent = document.getElementById('main-content');
        
        if (loader) {
          // Show main content
          if (mainContent) {
            mainContent.style.display = 'block';
          }
          
          // Fade out loader
          loader.style.opacity = '0';
          loader.style.transition = 'opacity 0.5s ease-out';
          
          setTimeout(() => {
            if (loader.parentNode) {
              loader.remove();
            }
            
            // Log performance (only in development)
            if (!appConfig.isProduction) {
              const loadTime = performance.now() - perfStart;
              console.log(`🚀 TaskFlow loaded in ${Math.round(loadTime)}ms`);
            }
          }, 500);
        }
      };

      // Set environment indicator safely
      const setEnvironmentIndicator = () => {
        try {
          getConfigFromApp();
          
          if (!appConfig.isProduction) {
            document.documentElement.classList.add(`env-${appConfig.environment}`);
            const indicator = document.getElementById('env-indicator');
            if (indicator) {
              indicator.textContent = appConfig.environment.toUpperCase();
            }
          }
        } catch (e) {
          console.warn('Could not set environment indicator:', e.message);
        }
      };
      
      // Safe performance monitoring links
      const addPerformanceLinks = () => {
        try {
          if (appConfig.apiUrl && appConfig.apiUrl !== 'undefined') {
            // Dynamically add preconnect and dns-prefetch
            const preconnect = document.createElement('link');
            preconnect.rel = 'preconnect';
            preconnect.href = appConfig.apiUrl;
            preconnect.crossOrigin = 'anonymous';
            document.head.appendChild(preconnect);

            const dnsPrefetch = document.createElement('link');
            dnsPrefetch.rel = 'dns-prefetch';
            dnsPrefetch.href = appConfig.apiUrl;
            document.head.appendChild(dnsPrefetch);
          }
        } catch (e) {
          console.warn('Could not add performance links:', e.message);
        }
      };
      
      // Remove loader when content is ready
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
          setTimeout(() => {
            setEnvironmentIndicator();
            addPerformanceLinks();
            removeLoader();
          }, 1000);
        });
      } else {
        setTimeout(() => {
          setEnvironmentIndicator();
          addPerformanceLinks();
          removeLoader();
        }, 1000);
      }
      
      // Service Worker registration with better error handling
      const registerServiceWorker = () => {
        if ('serviceWorker' in navigator && appConfig.isProduction) {
          window.addEventListener('load', () => {
            navigator.serviceWorker.register('/sw.js')
              .then((registration) => {
                if (!appConfig.isProduction) {
                  console.log('🔧 Service Worker registered:', registration);
                }
                
                // Handle updates
                registration.addEventListener('updatefound', () => {
                  const newWorker = registration.installing;
                  if (newWorker) {
                    newWorker.addEventListener('statechange', () => {
                      if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                        // New version available
                        window.dispatchEvent(new CustomEvent('sw-update-available'));
                      }
                    });
                  }
                });
              })
              .catch((error) => {
                if (!appConfig.isProduction) {
                  console.log('❌ Service Worker registration failed:', error);
                }
              });
          });
        }
      };
      
      // PWA install prompt handling
      let deferredPrompt;
      window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        
        if (!appConfig.isProduction) {
          console.log('💾 PWA install prompt available');
        }
        
        // Dispatch custom event for React app
        window.dispatchEvent(new CustomEvent('pwa-installable', {
          detail: { prompt: deferredPrompt }
        }));
      });
      
      // PWA install function for React app
      window.showInstallPrompt = async () => {
        if (deferredPrompt) {
          try {
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            
            if (!appConfig.isProduction) {
              console.log(`PWA install ${outcome}`);
            }
            
            window.dispatchEvent(new CustomEvent('pwa-install-result', {
              detail: { outcome }
            }));
            
            deferredPrompt = null;
          } catch (e) {
            console.warn('PWA install prompt failed:', e.message);
          }
        }
      };
      
      // Track PWA usage analytics
      if (window.matchMedia('(display-mode: standalone)').matches) {
        if (!appConfig.isProduction) {
          console.log('📱 Running as installed PWA');
        }
        document.documentElement.classList.add('pwa-standalone');
      }
      
      // iOS PWA detection
      const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
      const isInStandaloneMode = ('standalone' in window.navigator) && (window.navigator.standalone);
      
      if (isIOS) {
        document.documentElement.classList.add('ios-device');
        if (!isInStandaloneMode && !appConfig.isProduction) {
          console.log('📱 iOS device detected - PWA installable');
        }
      }
      
      // Enhanced error handling for better UX
      window.addEventListener('error', (event) => {
        try {
          const errorInfo = {
            message: event.error?.message || event.message || 'Unknown error',
            filename: event.filename || 'Unknown file',
            lineno: event.lineno || 0,
            timestamp: new Date().toISOString()
          };

          if (!appConfig.isProduction) {
            console.error('🚨 JavaScript error:', errorInfo);
          }
          
          // Report critical errors in production
          if (appConfig.isProduction && window.reportError) {
            window.reportError(errorInfo);
          }
        } catch (e) {
          // Fallback error handling
          console.error('Error in error handler:', e.message);
        }
      });
      
      // Network status monitoring
      const updateNetworkStatus = (online) => {
        try {
          document.documentElement.classList.toggle('offline', !online);
          document.documentElement.classList.toggle('online', online);
          
          // Dispatch event for React app
          window.dispatchEvent(new CustomEvent('network-change', {
            detail: { online }
          }));
          
          if (!appConfig.isProduction) {
            console.log(online ? '🌐 Back online' : '📱 Gone offline');
          }
        } catch (e) {
          console.warn('Error updating network status:', e.message);
        }
      };
      
      window.addEventListener('online', () => updateNetworkStatus(true));
      window.addEventListener('offline', () => updateNetworkStatus(false));
      
      // Initial network status
      updateNetworkStatus(navigator.onLine);
      
      // Initialize all features
      setTimeout(() => {
        try {
          getConfigFromApp();
          registerServiceWorker();
          
          // Global app info for debugging (development only)
          if (!appConfig.isProduction) {
            window.TaskFlowDebug = appConfig;
          }
        } catch (e) {
          console.warn('Error initializing app features:', e.message);
        }
      }, 2000);
    </script>
  </body>
</html>